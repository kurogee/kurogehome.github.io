<!DOCTYPE html>
<html>
    <head>
        <title>色当てクイズ</title>
        <meta charset="utf-8">
        <!-- JQuery -->
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

        <meta charset="utf-8">
        <link rel="stylesheet" href="../../pagestyle.css">
        <link rel="shortcut icon" href="../../icon.webp" type="image/webp">
        <meta name="viewport" content="width=device-width,initial-scale=1">
    </head>
    <body>
        <div id="box"><a href="../../index.html">Index</a> | <a href="../../projects/index.html">Projects</a> |  <a href="../../notification/index.html">Notification</a></div>
        <p></p>

        <div id="box">
            <h2>色当てクイズ</h2>
            <p>
                このゲームは、ランダムに生成された色とできるだけ同じ色を作るゲームです。<br>
                同じ色を作ることができるかな？
            </p>
        </div>
        <br>
        <div class="box">
            <br>
            <button onclick="new_game();" class="button">ニューゲーム</button>
            <br><br>
            <div id="game" class="box for_color">
                <div>
                    <table>
                        <tr>
                            <th>見本</th><th>プレビュー</th>
                        </tr>
                        <tr>
                            <td>
                                <span id="example" class="color"></span>
                            </td>
                            <td>
                                <span id="preview" class="color"></span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                色調節<br>
                                <small>
                                    RGB <input type="range" id="game_mode" style="width: 15%;" min="0" max="1" value="0" oninput="change_game_mode();"> CMY<br>
                                    <span id="color_explain"></span>
                                </small>
                            </td>
                            <td>
                                <span id="cr"></span> <input type="range" id="r" min="0" max="255" value="0" oninput="change_color();" style="width: 65%;"><input type="text" id="r_number" style="width: 20%;" readonly><br>
                                <span id="mg"></span> <input type="range" id="y" min="0" max="255" value="0" oninput="change_color();" style="width: 65%;"><input type="text" id="y_number" style="width: 20%;" readonly><br>
                                <span id="yb"></span> <input type="range" id="b" min="0" max="255" value="0" oninput="change_color();" style="width: 65%;"><input type="text" id="b_number" style="width: 20%;" readonly><br>
                            </td>
                        </tr>
                    </table>
                </div>
                <br>
                <div>
                    <button onclick="enter();" class="button">決定！</button><br>
                    <div id="detail_score"></div>
                    <br>
                </div>
            </div>
            <br>
        </div>

        <script>
            let example_r, example_y, example_b;
            let r, y, b;
            let game_mode = 0;

            function change_game_mode() {
                game_mode = parseInt($("#game_mode").val());
                $("#preview").css("background-color", "rgb(" + convert_color(r, y, b).join(",") + ")");

                if (game_mode == 0) {
                    $("#color_explain").html(`R : 赤<br>G : 緑<br>B : 青`);
                    $("#cr").html("R");
                    $("#mg").html("G");
                    $("#yb").html("B");
                } else {
                    $("#color_explain").html(`C : 青(シアン)<br>M : 赤(マゼンタ)<br>Y : 黄`);
                    $("#cr").html("C");
                    $("#mg").html("M");
                    $("#yb").html("Y");
                }
            }

            function reset() {
                $("#r").val(0);
                $("#y").val(0);
                $("#b").val(0);

                $("#r_number").val(0);
                $("#y_number").val(0);
                $("#b_number").val(0);
            }

            // 色の三原色を光の三原色に変換
            function convert_color(r, g, b) {
                if (game_mode == 0) return [r, g, b];

                let m = 255 * (1 - r / 255);
                let y = 255 * (1 - g / 255);
                let c = 255 * (1 - b / 255);
                return [m, y, c];
            }

            function change_color(cr, cy, cb) {
                if (cr != undefined) {
                    $("#r").val(cr);
                    $("#r_number").val(cr);
                } else {
                    r = parseInt($("#r").val());
                    $("#r").val(r);
                    $("#r_number").val(r);
                }

                if (cy != undefined) {
                    $("#y").val(cy);
                    $("#y_number").val(cy);
                } else {
                    y = parseInt($("#y").val());
                    $("#y").val(y);
                    $("#y_number").val(y);
                }

                if (cb != undefined) {
                    $("#b").val(cb);
                    $("#b_number").val(cb);
                } else {
                    b = parseInt($("#b").val());
                    $("#b").val(b);
                    $("#b_number").val(b);
                }

                $("#preview").css("background-color", "rgb(" + convert_color(r, y, b).join(",") + ")");
            }

            function new_game() {
                example_r = Math.floor(Math.random() * 256);
                example_y = Math.floor(Math.random() * 256);
                example_b = Math.floor(Math.random() * 256);

                reset();

                $("#example").css("background-color", "rgb(" + convert_color(example_r, example_y, example_b).join(",") + ")");
            }

            function enter() {
                let r = parseInt($("#r").val());
                let y = parseInt($("#y").val());
                let b = parseInt($("#b").val());

                let convert;
                if (game_mode == 0) {
                    convert = [r, y, b];
                } else {
                    convert = [255 - r, 255 - y, 255 - b];
                }
                
                // 色の似ている度合いを百分率で計算
                let score = 100 - (Math.abs(convert[0] - example_r) + Math.abs(convert[1] - example_y) + Math.abs(convert[2] - example_b)) / 7.65;

                // 似ている度合いでA〜Fでランク分け
                let rank;
                if (score >= 97) {
                    rank = "S";
                } else if (score >= 90) {
                    rank = "A";
                } else if (score >= 80) {
                    rank = "B";
                } else if (score >= 70) {
                    rank = "C";
                } else if (score >= 60) {
                    rank = "D";
                } else if (score >= 50) {
                    rank = "E";
                } else {
                    rank = "F";
                }

                let result = `<h2>〜結果〜</h2>
                <h3>ランク : ${rank}</h3>
                <p>似ている度合い : ${score.toFixed(2)}%</p>
                <p>正解 : `;
                
                if (game_mode == 0) {
                    result += `R : ${example_r}, G : ${example_y}, B : ${example_b}`;
                } else {
                    // CMY用に数値を変換して表示
                    result += `C : ${255 - example_r}, M : ${255 - example_y}, Y : ${255 - example_b}`;
                }

                // 結果を表示
                $("#detail_score").html(result);
            }

            onload = function() {
                change_game_mode();
            }
        </script>

        <style>
            .color {
                display: inline-block;
                width: 80px;
                height: 80px;
                border: 3px solid black;
            }
        </style>
    </body>
</html>