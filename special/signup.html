<!DOCTYPE html>
<html lang="ja">
<head>
    <base href="../">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="kurogehomeは@kuroge_が運営するホームページです！技術的なことを多く発信しているのでぜひ見ていってください！">
    <link rel="icon" type="image/webp" href="image/icon.webp">
    <link rel="stylesheet" href="pageStyle2.0.css">
    <title>会員ページ - 登録</title>
</head>
<body>
    <div class="menu">
        <a href="./index.html"><img src="image/トップ.webp" id="ueicon" alt="index"></a>
        <a href="./my.html"><img src="image/my.webp" id="ueicon" alt="about me"></a>
        <a href="./web.html"><img src="image/サーチ.webp" id="ueicon" alt="search"></a>
        <a href="./program.html"><img src="image/プログラム.webp" id="ueicon" alt="programs"></a>
        <a href="./uranai.html"><img src="image/占い.webp" id="ueicon" alt="divination"></a>
        <a href="./scratch/project/kakutou/index.html"><img src="image/kakutou.webp" id="ueicon" alt="Kakutou Game"></a>
    </div>
    <div id="honbun">
        <div id="box">
            <h2>会員ページ登録</h2>
            <p>
                あいことばというのは、パスワードのようなものです。<br>
                ですがセキュリティで保護されていないので、いつも使っているものではないフレーズを設定してください。
            </p>
            <p>
                登録が完了したら、自動的にログインページに飛びます<br>
                自分の合言葉を変えるには手続きが必要なので<em>確実</em>に入力してください
            </p>
            
            <hr>

            <h3>
                <form>
                    ID: <input type="text" name="id" id="user_id"><br>
                    あいことば: <input type="password" name="pass" id="user_pass">
                    <br>
                    <input type="hidden" name="req" value="join" id="req">
                    <input type="button" value="決定" onclick="signup();">　<input type="reset" value="取り消し">
                </form>
                <small id="states"></small>
            </h3>
            <a href="" id="url"></a>
        </div>
    </div>

    <script src="cookie.js"></script>
    <script src="date.js"></script>
    <script>
        async function signup() {
            const states = document.getElementById("states");
            states.innerHTML = "お待ちください...";
            states.style.color = "red";

            if (document.getElementById("user_id").value != "" && document.getElementById("user_pass").value != "") {
                const response = await fetch(
                    "https://script.google.com/macros/s/AKfycby5ov2Fa-0CmKpDUmxXGxrb1Wrq5aoG8v26VCBdoKHj07e1oA05M6h3zOzJVIJPJ4nR/exec",
                    {
                        method: "POST",
                        body: JSON.stringify({
                            "id": document.getElementById("user_id").value,
                            "pass": document.getElementById("user_pass").value,
                            "req": document.getElementById("req").value
                        })
                    }
                )
                .then((response) => response.text())

                .then((data)=>{
                    return JSON.parse(data);
                })

                .catch((error) => {
                    return "posterror";
                });

                if (response.result.match("no")) {
                    states.innerHTML = "エラー: 同じIDがすでに登録されています";
                    console.log(response)
                
                } else if (response.result.match("ok")) {
                    const url = document.getElementById("url")

                    sessionStorage.states = true;
                    url.href = "./special/index.html";
                    url.click();
                }
            } else {
                states.innerHTML = "エラー: あいことばもIDも入力してください";
            }
            
        }
    </script>
</body>
</html>
